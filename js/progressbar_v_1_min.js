/*!
 * Progress Bar V 1.0 ~
 * Copyright (c) 2013 Vicky Gonsalves
 * http://vickygonsalves.vacau.com/license.html
 * Contact +91- 8097598395, +91-9766222843
 */
(function(){var e=[],t=function(e,t){var n=this,r=document,i;n._target=r.getElementById(e);n.options={imagesToPreload:"all",showProgressBar:false,loaderImagePath:"http://mapsonline.dundeecity.gov.uk/DCC_GIS_Root/dcc_GIS_Config/images/loading.gif",showLoader:true,showLoadingText:false,loadingText:"Loading",loadingTextClass:null,loaderStyle:"opaque",transparency:1,backgroundColor:"#000",initAnimation:null,destroyAnimation:null,initAnimationSpeed:10,log:true};for(i in t)n.options[i]=t[i];n._initLoader()};t.prototype={progress:0,imagesLoaded:0,imagesNotLoaded:0,_loading:false,_start:function(){var e=this,t=document;if(e.options.showProgressBar){e._showProgressBar()}e._preloadAllImages(e._collectAllImages())},_collectAllImages:function(){var t=this,n=document;t._getallBgimages();return e},_initLoader:function(){var e=this,t=document,n,r,i,s,o,u;e._target.style.display="none";if(e.options.showLoadingText){u=t.createElement("div");u.setAttribute("id","__defaultLoadingText");u.innerHTML=e.options.loadingText;u.style.width="100%";u.style.position="absolute";u.style.textAlign="center";u.style.top="50%";u.style.left="0";u.className=e.options.loadingTextClass;u.style.zIndex="99999999999999";t.body.insertBefore(u,t.body.firstChild)}if(e.options.showLoader){r=new Image;r.src=e.options.loaderImagePath;r.onload=function(){i=r.width;s=r.height;n=t.createElement("div");n.setAttribute("id","__defaultLoader");n.style.width=i+"px";n.style.height=s+"px";n.style.position="absolute";n.style.left="50%";n.style.marginLeft=-(i/2)+"px";n.style.top="50%";n.style.marginTop=-(s/2)+"px";n.style.zIndex="99999999999998";n.style.background="url('"+e.options.loaderImagePath+"') center no-repeat";t.body.insertBefore(n,t.body.firstChild);if(e.options.loaderStyle=="transparent"){o=t.createElement("div");o.setAttribute("id","__defaultTransBG");o.style.width="100%";o.style.height="100%";o.style.position="fixed";o.style.webkitBackfaceVisibility="hidden";o.style.left="0px";o.style.top="0px";o.style.zIndex="99999999999997";o.style.background=e.options.backgroundColor;o.style.opacity=e.options.transparency;if(e.options.initAnimation=="fadein"){o.style.opacity=0}t.body.insertBefore(o,t.body.firstChild);e._target.style.display="block"}if(e.options.loaderStyle=="transparent"&&e.options.initAnimation=="fadein"){var u=0;var a=setInterval(function(){u++;if(u/100<e.options.transparency){o.style.opacity=u/100}else{clearInterval(a)}},e.options.initAnimationSpeed)}e._start()}}else{e._start()}},_destroyLoader:function(){var e=this,t=document,n,r;if(e.options.showLoader){if(e.options.loaderStyle=="transparent"&&e.options.destroyAnimation=="fadeout"){var i=e.options.transparency;var s=setInterval(function(){i=i-.01;if(i>=0){document.getElementById("__defaultTransBG").style.opacity=i}else{clearInterval(s);r=document.getElementById("__defaultLoader");r.parentNode.removeChild(r);r=document.getElementById("__defaultTransBG");r.parentNode.removeChild(r);if(e.options.showLoadingText){r=document.getElementById("__defaultLoadingText");r.parentNode.removeChild(r)}}},e.options.initAnimationSpeed)}else{if(e._loading){r=document.getElementById("__defaultLoader");r.parentNode.removeChild(r);if(e.options.loaderStyle=="transparent"){r=document.getElementById("__defaultTransBG");r.parentNode.removeChild(r)}if(e.options.showLoadingText){r=document.getElementById("__defaultLoadingText");r.parentNode.removeChild(r)}}}}},_getallBgimages:function(){var t=this,n=document,r,i=t._target.getElementsByTagName("*");i=e.slice.call(i,0,i.length);while(i.length){r=t._deepCss(i.shift(),"background-image");if(r)r=/url\(['"]?([^")]+)/.exec(r)||[];r=r[1];if(r&&e.indexOf(r)==-1)e[e.length]=r}t._getallImages()},_getallImages:function(){var t=this,n=document,r,i=t._target.getElementsByTagName("img");i=e.slice.call(i,0,i.length);while(i.length){r=t._deepSrc(i.shift());if(r)r=r||[];if(r&&e.indexOf(r)==-1)e[e.length]=r}},_deepSrc:function(e){if(!e||!e.src)return"";return e.src},_deepCss:function(e,t){if(!e||!e.style)return"";var n=t.replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()});if(e.currentStyle){return e.style[n]||e.currentStyle[n]||""}var r=document.defaultView||window;return e.style[n]||r.getComputedStyle(e,"").getPropertyValue(t)||""},_preloadAllImages:function(e){var t=this,n=document,r=[],i=0,s=0,o=0;if(t.options.log){try{console.warn("Images Preloading Started")}catch(u){}}for(var a=0;a<e.length;a++){r[a]=new Image;r[a].src=e[a];if(t.options.log){try{console.log("Retriving Image :"+r[a].src)}catch(u){}}r[a].onerror=function(){++i;++o;t.imagesNotLoaded=o;t.progress=i*100/e.length;if(i==e.length){if(document.readyState=="complete"){t._destroyLoader();t._target.style.display="block";t.onLoad()}else{t._destroyLoader();t._target.style.display="block";t.onLoad()}if(t.options.log){try{console.warn("Total images loaded : "+s+"/"+i);console.warn("Total images Failed : "+o+"/"+i)}catch(n){}}}t._loading=true;t.onError();t.onProgress()};r[a].onload=function(){++i;++s;t.imagesLoaded=s;t.progress=i*100/e.length;if(t.options.log){try{console.log("Image Loaded :"+e[i-1])}catch(n){}}if(i==e.length){if(document.readyState=="complete"){t._destroyLoader();t._target.style.display="block";t.onLoad()}else{t._destroyLoader();t._target.style.display="block";t.onLoad()}if(t.options.log){try{console.warn("Total images loaded : "+s+"/"+i);console.warn("Total images Failed : "+o+"/"+i)}catch(n){}}}t._loading=true;t.onProgress()}}},_showProgressBar:function(){var e=this,t=document},onLoad:function(){},onProgress:function(){},onError:function(){}};Array.prototype.indexOf=Array.prototype.indexOf||function(e,t){t=t||0;var n=this.length;while(t<n){if(this[t]===e)return t;++t}return-1};if(typeof exports!=="undefined")exports.progressBar=t;else window.progressBar=t})(window,document)