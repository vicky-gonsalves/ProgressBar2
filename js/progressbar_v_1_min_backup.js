/*!
 * Progress Bar V 1.0 ~
 * Copyright (c) 2013 Vicky Gonsalves
 * http://vickygonsalves.vacau.com/license.html
 * Contact +91- 8097598395, +91-9766222843
 */
(function(){var b=[],a=function(g,c){var e=this,f=document,d;e._target=f.getElementById(g);e.options={imagesToPreload:"all",showProgressBar:false,loaderImagePath:"http://mapsonline.dundeecity.gov.uk/DCC_GIS_Root/dcc_GIS_Config/images/loading.gif",showLoader:true,showLoadingText:false,loadingText:"Loading",loadingTextClass:null,loaderStyle:"opaque",transparency:1,backgroundColor:"#000",initAnimation:null,destroyAnimation:null,initAnimationSpeed:10,log:true};for(d in c){e.options[d]=c[d]}e._initLoader()};a.prototype={progress:0,imagesLoaded:0,imagesNotLoaded:0,_loading:false,_start:function(){var c=this,d=document;if(c.options.showProgressBar){c._showProgressBar()}c._preloadAllImages(c._collectAllImages())},_collectAllImages:function(){var c=this,d=document;c._getallBgimages();return b},_initLoader:function(){var i=this,j=document,d,h,f,e,c,g;i._target.style.display="none";if(i.options.showLoadingText){g=j.createElement("div");g.setAttribute("id","__defaultLoadingText");g.innerHTML=i.options.loadingText;g.style.width="100%";g.style.position="absolute";g.style.textAlign="center";g.style.top="50%";g.style.left="0";g.className=i.options.loadingTextClass;g.style.zIndex="99999999999999";j.body.insertBefore(g,j.body.firstChild)}if(i.options.showLoader){h=new Image();h.src=i.options.loaderImagePath;h.onload=function(){f=h.width;e=h.height;d=j.createElement("div");d.setAttribute("id","__defaultLoader");d.style.width=f+"px";d.style.height=e+"px";d.style.position="absolute";d.style.left="50%";d.style.marginLeft=-(f/2)+"px";d.style.top="50%";d.style.marginTop=-(e/2)+"px";d.style.zIndex="99999999999998";d.style.background="url('"+i.options.loaderImagePath+"') center no-repeat";j.body.insertBefore(d,j.body.firstChild);if(i.options.loaderStyle=="transparent"){c=j.createElement("div");c.setAttribute("id","__defaultTransBG");c.style.width="100%";c.style.height="100%";c.style.position="fixed";c.style.webkitBackfaceVisibility="hidden";c.style.left="0px";c.style.top="0px";c.style.zIndex="99999999999997";c.style.background=i.options.backgroundColor;c.style.opacity=i.options.transparency;if(i.options.initAnimation=="fadein"){c.style.opacity=0}j.body.insertBefore(c,j.body.firstChild);i._target.style.display="block"}if(i.options.loaderStyle=="transparent"&&i.options.initAnimation=="fadein"){var l=0;var k=setInterval(function(){l++;if((l/100)<i.options.transparency){c.style.opacity=l/100}else{clearInterval(k)}},i.options.initAnimationSpeed)}i._start()}}else{i._start()}},_destroyLoader:function(){var g=this,h=document,c,e;if(g.options.showLoader){if(g.options.loaderStyle=="transparent"&&g.options.destroyAnimation=="fadeout"){var d=g.options.transparency;var f=setInterval(function(){d=d-0.01;if(d>=0){document.getElementById("__defaultTransBG").style.opacity=d}else{clearInterval(f);e=document.getElementById("__defaultLoader");e.parentNode.removeChild(e);e=document.getElementById("__defaultTransBG");e.parentNode.removeChild(e);if(g.options.showLoadingText){e=document.getElementById("__defaultLoadingText");e.parentNode.removeChild(e)}}},g.options.initAnimationSpeed)}else{if(g._loading){e=document.getElementById("__defaultLoader");e.parentNode.removeChild(e);if(g.options.loaderStyle=="transparent"){e=document.getElementById("__defaultTransBG");e.parentNode.removeChild(e)}if(g.options.showLoadingText){e=document.getElementById("__defaultLoadingText");e.parentNode.removeChild(e)}}}}},_getallBgimages:function(){var e=this,f=document,d,c=(e._target).getElementsByTagName("*");c=b.slice.call(c,0,c.length);while(c.length){d=e._deepCss(c.shift(),"background-image");if(d){d=/url\(['"]?([^")]+)/.exec(d)||[]}d=d[1];if(d&&b.indexOf(d)==-1){b[b.length]=d}}e._getallImages()},_getallImages:function(){var c=this,d=document,f,e=c._target.getElementsByTagName("img");e=b.slice.call(e,0,e.length);while(e.length){f=c._deepSrc(e.shift());if(f){f=f||[]}if(f&&b.indexOf(f)==-1){b[b.length]=f}}},_deepSrc:function(c){if(!c||!c.src){return""}return c.src},_deepCss:function(f,e){if(!f||!f.style){return""}var c=e.replace(/\-([a-z])/g,function(h,g){return g.toUpperCase()});if(f.currentStyle){return f.style[c]||f.currentStyle[c]||""}var d=document.defaultView||window;return f.style[c]||d.getComputedStyle(f,"").getPropertyValue(e)||""},_preloadAllImages:function(h){var f=this,k=document,j=[],c=0,m=0,l=0;if(f.options.log){try{console.warn("Images Preloading Started")}catch(g){}}for(var d=0;d<h.length;d++){j[d]=new Image();j[d].src=h[d];if(f.options.log){try{console.log("Retriving Image :"+j[d].src)}catch(g){}}j[d].onerror=function(){++c;++l;f.imagesNotLoaded=l;f.progress=(c*100)/h.length;if(c==h.length){if(document.readyState=="complete"){f._destroyLoader();f.onLoad();f._target.style.display="block"}else{f._destroyLoader();f.onLoad();f._target.style.display="block"}if(f.options.log){try{console.warn("Total images loaded : "+m+"/"+c);console.warn("Total images Failed : "+l+"/"+c)}catch(i){}}}f._loading=true;f.onError();f.onProgress()};j[d].onload=function(){++c;++m;f.imagesLoaded=m;f.progress=(c*100)/h.length;if(f.options.log){try{console.log("Image Loaded :"+h[c-1])}catch(i){}}if(c==h.length){if(document.readyState=="complete"){f._destroyLoader();f.onLoad();f._target.style.display="block"}else{f._destroyLoader();f.onLoad();f._target.style.display="block"}if(f.options.log){try{console.warn("Total images loaded : "+m+"/"+c);console.warn("Total images Failed : "+l+"/"+c)}catch(i){}}}f._loading=true;f.onProgress()}}},_showProgressBar:function(){var c=this,d=document},onLoad:function(){},onProgress:function(){},onError:function(){}};Array.prototype.indexOf=Array.prototype.indexOf||function(e,d){d=d||0;var c=this.length;while(d<c){if(this[d]===e){return d}++d}return -1};if(typeof exports!=="undefined"){exports.progressBar=a}else{window.progressBar=a}})(window,document);